# Домашнее задание к занятию "08.03 Использование Yandex Cloud"

## Подготовка к выполнению

1. Подготовьте в Yandex Cloud три хоста: для `clickhouse`, для `vector` и для `lighthouse`.

Apply complete! Resources: 3 added, 0 changed, 1 destroyed.

```bash

Apply complete! Resources: 5 added, 0 changed, 0 destroyed.

Outputs:

internal_ip = {
  "clickhouse" = tolist([
    "10.2.0.31",
  ])
  "lighthouse" = tolist([
    "10.2.0.18",
  ])
  "vector" = tolist([
    "10.2.0.24",
  ])
}
nat_ip = {
  "clickhouse" = tolist([
    "51.250.75.143",
  ])
  "lighthouse" = tolist([
    "51.250.68.7",
  ])
  "vector" = tolist([
    "51.250.14.224",
  ])
}

iva@c9:~/Documents/Terraform $ yc compute instance list
+----------------------+---------------+---------------+---------+---------------+-------------+
|          ID          |     NAME      |    ZONE ID    | STATUS  |  EXTERNAL IP  | INTERNAL IP |
+----------------------+---------------+---------------+---------+---------------+-------------+
| fhmd1krukohd5ha6804v | c8-clickhouse | ru-central1-a | RUNNING | 51.250.75.143 | 10.2.0.31   |
| fhmh72hkh6a1ibccbqsm | c8-vector     | ru-central1-a | RUNNING | 51.250.14.224 | 10.2.0.24   |
| fhmolvp0heuu1hklfs6b | c8-lighthouse | ru-central1-a | RUNNING | 51.250.68.7   | 10.2.0.18   |
+----------------------+---------------+---------------+---------+---------------+-------------+

```

## Основная часть

1. Допишите playbook: нужно сделать ещё один play, который устанавливает и настраивает lighthouse.
2. При создании tasks рекомендую использовать модули: `get_url`, `template`, `yum`, `apt`.
3. Tasks должны: скачать статику lighthouse, установить nginx или любой другой webserver, настроить его конфиг для открытия lighthouse, запустить webserver.
4. Приготовьте свой собственный inventory файл `prod.yml`.
5. Запустите `ansible-lint site.yml` и исправьте ошибки, если они есть.
6. Попробуйте запустить playbook на этом окружении с флагом `--check`.
7. Запустите playbook на `prod.yml` окружении с флагом `--diff`. Убедитесь, что изменения на системе произведены.
8. Повторно запустите playbook с флагом `--diff` и убедитесь, что playbook идемпотентен.
9. Подготовьте README.md файл по своему playbook. В нём должно быть описано: что делает playbook, какие у него есть параметры и теги.
10. Готовый playbook выложите в свой репозиторий, поставьте тег [08-ansible-03-yandex](https://github.com/Ingvar78/08-ansible/releases/tag/08-ansible-03-yandex) на фиксирующий коммит, в ответ предоставьте ссылку на него.

---

### Порядок выполнения playbook

<details>
     <summary>Решение Задачи *</summary>
    <br>


```bash
va@c9:~/Documents/08-ansible/08-3/src/ansible  (08.3 *)$ ansible-lint 
WARNING: PATH altered to include /usr/bin

```

```
iva@c9:~/Documents/08-ansible/08-3/src/ansible  (08.3 *)$ ansible-playbook site.yml -i inventory/prod.yml 

PLAY [Drop database Clickhouse] *****************************************************************************************************************************************************************************************************************************************************

PLAY [Clickhouse | Install Clickhouse] **********************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [FireWall Clickhouse | Разрешим 8123 порт] *************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [FireWall Clickhouse | Перезапустим service firewalld] *************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | Get clickhouse distrib] ******************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse] => (item=clickhouse-client)
changed: [c8-clickhouse] => (item=clickhouse-server)

TASK [Clickhouse | Get clickhouse distrib static] ***********************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | Install clickhouse packages] *************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Flush handlers] ***************************************************************************************************************************************************************************************************************************************************************

RUNNING HANDLER [Start clickhouse service] ******************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Delay befor create DB - Pause playbook] ***************************************************************************************************************************************************************************************************************************************
Pausing for 10 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [c8-clickhouse]

TASK [Clickhouse | Create database] *************************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | Create log table] ************************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | General config] **************************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

RUNNING HANDLER [Start clickhouse service] ******************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

PLAY [Install Vector] ***************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Add clickhouse addresses to /etc/hosts] ******************************************************************************************************************************************************************************************************************************
changed: [c8-vector] => (item=c8-clickhouse)

TASK [Vector | Get vector distrib] **************************************************************************************************************************************************************************************************************************************************
changed: [c8-vector]

TASK [Vector | Install vector rpm] **************************************************************************************************************************************************************************************************************************************************
changed: [c8-vector]

TASK [Add vector user to systemd-journal group] *************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Update vector config] ************************************************************************************************************************************************************************************************************************************************
changed: [c8-vector]

TASK [Vector | Create vector config] ************************************************************************************************************************************************************************************************************************************************
changed: [c8-vector]

TASK [Replace host ip] **************************************************************************************************************************************************************************************************************************************************************
changed: [c8-vector] => (item=c8-clickhouse)

RUNNING HANDLER [Start vector service] **********************************************************************************************************************************************************************************************************************************************
changed: [c8-vector]

PLAY [Install Nginx] ****************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]
ok: [c8-lighthouse]

TASK [Nginx | Install eper-release] *************************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

TASK [Nginx | Install Nginx] ********************************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

TASK [Nginx | Create general config] ************************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

TASK [Nginx | Разрешим 80 порт] *****************************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

TASK [Nginx | Перезапустим service firewalld на всех узлах] *************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

RUNNING HANDLER [Start nginx] *******************************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

RUNNING HANDLER [Reload nginx] ******************************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

PLAY [Install LightHouse] ***********************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [LightHouse | Install git] *****************************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]

TASK [Add clickhouse addresses to /etc/hosts] ***************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse] => (item=c8-clickhouse)

TASK [LightHouse | Get from git repo] ***********************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]

TASK [LightHouse | LightHouse nginx config] *****************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]

RUNNING HANDLER [Reload Nginx] ******************************************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]

PLAY RECAP **************************************************************************************************************************************************************************************************************************************************************************
c8-clickhouse              : ok=12   changed=10   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
c8-lighthouse              : ok=14   changed=12   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
c8-vector                  : ok=17   changed=14   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

iva@c9:~/Documents/08-ansible/08-3/src/ansible  (08.3 *)$ ansible-playbook site.yml -i inventory/prod.yml --check

PLAY [Drop database Clickhouse] *****************************************************************************************************************************************************************************************************************************************************

PLAY [Clickhouse | Install Clickhouse] **********************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [FireWall Clickhouse | Разрешим 8123 порт] *************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [FireWall Clickhouse | Перезапустим service firewalld] *************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | Get clickhouse distrib] ******************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse] => (item=clickhouse-client)
ok: [c8-clickhouse] => (item=clickhouse-server)

TASK [Clickhouse | Get clickhouse distrib static] ***********************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [Clickhouse | Install clickhouse packages] *************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [Flush handlers] ***************************************************************************************************************************************************************************************************************************************************************

TASK [Delay befor create DB - Pause playbook] ***************************************************************************************************************************************************************************************************************************************
Pausing for 10 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [c8-clickhouse]

TASK [Clickhouse | Create database] *************************************************************************************************************************************************************************************************************************************************
skipping: [c8-clickhouse]

TASK [Clickhouse | Create log table] ************************************************************************************************************************************************************************************************************************************************
skipping: [c8-clickhouse]

TASK [Clickhouse | General config] **************************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

RUNNING HANDLER [Start clickhouse service] ******************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

PLAY [Install Vector] ***************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Add clickhouse addresses to /etc/hosts] ******************************************************************************************************************************************************************************************************************************
ok: [c8-vector] => (item=c8-clickhouse)

TASK [Vector | Get vector distrib] **************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Install vector rpm] **************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Add vector user to systemd-journal group] *************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Update vector config] ************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Create vector config] ************************************************************************************************************************************************************************************************************************************************
changed: [c8-vector]

TASK [Replace host ip] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector] => (item=c8-clickhouse)

PLAY [Install Nginx] ****************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]
ok: [c8-lighthouse]

TASK [Nginx | Install eper-release] *************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Install Nginx] ********************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Create general config] ************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Разрешим 80 порт] *****************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Перезапустим service firewalld на всех узлах] *************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

PLAY [Install LightHouse] ***********************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [LightHouse | Install git] *****************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [Add clickhouse addresses to /etc/hosts] ***************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse] => (item=c8-clickhouse)

TASK [LightHouse | Get from git repo] ***********************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [LightHouse | LightHouse nginx config] *****************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

PLAY RECAP **************************************************************************************************************************************************************************************************************************************************************************
c8-clickhouse              : ok=9    changed=3    unreachable=0    failed=0    skipped=2    rescued=0    ignored=0   
c8-lighthouse              : ok=11   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
c8-vector                  : ok=14   changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```

```bash
iva@c9:~/Documents/08-ansible/08-3/src/ansible  (08.3 *)$ ansible-playbook site.yml -i inventory/prod.yml --diff

PLAY [Drop database Clickhouse] *****************************************************************************************************************************************************************************************************************************************************

PLAY [Clickhouse | Install Clickhouse] **********************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [FireWall Clickhouse | Разрешим 8123 порт] *************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [FireWall Clickhouse | Перезапустим service firewalld] *************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | Get clickhouse distrib] ******************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse] => (item=clickhouse-client)
ok: [c8-clickhouse] => (item=clickhouse-server)

TASK [Clickhouse | Get clickhouse distrib static] ***********************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [Clickhouse | Install clickhouse packages] *************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [Flush handlers] ***************************************************************************************************************************************************************************************************************************************************************

TASK [Delay befor create DB - Pause playbook] ***************************************************************************************************************************************************************************************************************************************
Pausing for 10 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [c8-clickhouse]

TASK [Clickhouse | Create database] *************************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [Clickhouse | Create log table] ************************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | General config] **************************************************************************************************************************************************************************************************************************************************
--- before: /etc/clickhouse-server/config.xml
+++ after: /home/iva/.ansible/tmp/ansible-local-15146n3aye7ts/tmpykqv1pdf/clickhouse.xml.j2
@@ -185,9 +185,9 @@
     <!-- Default values - try listen localhost on IPv4 and IPv6. -->
     <!-- 
     <listen_host>::1</listen_host>
-    <listen_host>127.0.0.1</listen_host> 
-    <listen_host>0.0.0.0</listen_host> -->
-
+    <listen_host>127.0.0.1</listen_host> -->
+    <listen_host>0.0.0.0</listen_host>
+    
 
     <!-- Don't exit if IPv6 or IPv4 networks are unavailable while trying to listen. -->
     <!-- <listen_try>0</listen_try> -->

changed: [c8-clickhouse]

RUNNING HANDLER [Start clickhouse service] ******************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

PLAY [Install Vector] ***************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Add clickhouse addresses to /etc/hosts] ******************************************************************************************************************************************************************************************************************************
ok: [c8-vector] => (item=c8-clickhouse)

TASK [Vector | Get vector distrib] **************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Install vector rpm] **************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Add vector user to systemd-journal group] *************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Update vector config] ************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Create vector config] ************************************************************************************************************************************************************************************************************************************************
--- before: /etc/vector/config.yaml
+++ after: /home/iva/.ansible/tmp/ansible-local-15146n3aye7ts/tmp__6ubkka
@@ -5,7 +5,7 @@
   to_clickhouse:
     compression: gzip
     database: logs
-    endpoint: http://51.250.75.143:8123
+    endpoint: http://c8-clickhouse:8123
     healthcheck: false
     inputs:
     - any_logs

changed: [c8-vector]

TASK [Replace host ip] **************************************************************************************************************************************************************************************************************************************************************
--- before: /etc/vector/config.yaml
+++ after: /etc/vector/config.yaml
@@ -5,7 +5,7 @@
   to_clickhouse:
     compression: gzip
     database: logs
-    endpoint: http://c8-clickhouse:8123
+    endpoint: http://51.250.75.143:8123
     healthcheck: false
     inputs:
     - any_logs

changed: [c8-vector] => (item=c8-clickhouse)

RUNNING HANDLER [Start vector service] **********************************************************************************************************************************************************************************************************************************************
changed: [c8-vector]

PLAY [Install Nginx] ****************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]
ok: [c8-lighthouse]

TASK [Nginx | Install eper-release] *************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Install Nginx] ********************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Create general config] ************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Разрешим 80 порт] *****************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Перезапустим service firewalld на всех узлах] *************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

PLAY [Install LightHouse] ***********************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [LightHouse | Install git] *****************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [Add clickhouse addresses to /etc/hosts] ***************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse] => (item=c8-clickhouse)

TASK [LightHouse | Get from git repo] ***********************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [LightHouse | LightHouse nginx config] *****************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

PLAY RECAP **************************************************************************************************************************************************************************************************************************************************************************
c8-clickhouse              : ok=11   changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
c8-lighthouse              : ok=11   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
c8-vector                  : ok=15   changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

iva@c9:~/Documents/08-ansible/08-3/src/ansible  (08.3 *)$ 
```

```bash
iva@c9:~/Documents/08-ansible/08-3/src/ansible  (08.3 *)$ ansible-playbook site.yml -i inventory/prod.yml --diff

PLAY [Drop database Clickhouse] *****************************************************************************************************************************************************************************************************************************************************

PLAY [Clickhouse | Install Clickhouse] **********************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [FireWall Clickhouse | Разрешим 8123 порт] *************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [FireWall Clickhouse | Перезапустим service firewalld] *************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | Get clickhouse distrib] ******************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse] => (item=clickhouse-client)
ok: [c8-clickhouse] => (item=clickhouse-server)

TASK [Clickhouse | Get clickhouse distrib static] ***********************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [Clickhouse | Install clickhouse packages] *************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [Flush handlers] ***************************************************************************************************************************************************************************************************************************************************************

TASK [Delay befor create DB - Pause playbook] ***************************************************************************************************************************************************************************************************************************************
Pausing for 10 seconds
(ctrl+C then 'C' = continue early, ctrl+C then 'A' = abort)
ok: [c8-clickhouse]

TASK [Clickhouse | Create database] *************************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

TASK [Clickhouse | Create log table] ************************************************************************************************************************************************************************************************************************************************
changed: [c8-clickhouse]

TASK [Clickhouse | General config] **************************************************************************************************************************************************************************************************************************************************
ok: [c8-clickhouse]

PLAY [Install Vector] ***************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Add clickhouse addresses to /etc/hosts] ******************************************************************************************************************************************************************************************************************************
ok: [c8-vector] => (item=c8-clickhouse)

TASK [Vector | Get vector distrib] **************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Install vector rpm] **************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Add vector user to systemd-journal group] *************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Update vector config] ************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]

TASK [Vector | Create vector config] ************************************************************************************************************************************************************************************************************************************************
--- before: /etc/vector/config.yaml
+++ after: /home/iva/.ansible/tmp/ansible-local-16998z11qh28s/tmpjct6v0p1
@@ -5,7 +5,7 @@
   to_clickhouse:
     compression: gzip
     database: logs
-    endpoint: http://51.250.75.143:8123
+    endpoint: http://c8-clickhouse:8123
     healthcheck: false
     inputs:
     - any_logs

changed: [c8-vector]

TASK [Replace host ip] **************************************************************************************************************************************************************************************************************************************************************
--- before: /etc/vector/config.yaml
+++ after: /etc/vector/config.yaml
@@ -5,7 +5,7 @@
   to_clickhouse:
     compression: gzip
     database: logs
-    endpoint: http://c8-clickhouse:8123
+    endpoint: http://51.250.75.143:8123
     healthcheck: false
     inputs:
     - any_logs

changed: [c8-vector] => (item=c8-clickhouse)

RUNNING HANDLER [Start vector service] **********************************************************************************************************************************************************************************************************************************************
changed: [c8-vector]

PLAY [Install Nginx] ****************************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-vector]
ok: [c8-lighthouse]

TASK [Nginx | Install eper-release] *************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Install Nginx] ********************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Create general config] ************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Разрешим 80 порт] *****************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]
ok: [c8-vector]

TASK [Nginx | Перезапустим service firewalld на всех узлах] *************************************************************************************************************************************************************************************************************************
changed: [c8-lighthouse]
changed: [c8-vector]

PLAY [Install LightHouse] ***********************************************************************************************************************************************************************************************************************************************************

TASK [Gathering Facts] **************************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [LightHouse | Install git] *****************************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [Add clickhouse addresses to /etc/hosts] ***************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse] => (item=c8-clickhouse)

TASK [LightHouse | Get from git repo] ***********************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

TASK [LightHouse | LightHouse nginx config] *****************************************************************************************************************************************************************************************************************************************
ok: [c8-lighthouse]

PLAY RECAP **************************************************************************************************************************************************************************************************************************************************************************
c8-clickhouse              : ok=10   changed=2    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
c8-lighthouse              : ok=11   changed=1    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
c8-vector                  : ok=15   changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   
```
</detail>
---


